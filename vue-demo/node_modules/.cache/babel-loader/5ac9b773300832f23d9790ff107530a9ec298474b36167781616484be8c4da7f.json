{"ast":null,"code":"import { ref, onMounted, reactive } from \"vue\";\nimport axios from \"axios\";\nimport store from \"@/store\";\nexport default {\n  __name: 'Cart',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const Buy = scope => {\n      console.log(scope);\n      dialogVisible.value = true;\n    };\n    const Pay = (scope, address) => {\n      console.log(scope.row);\n      var productid = scope.row.product.id;\n      var quantity = scope.row.quantity;\n      var product;\n      axios.get('/products', {\n        params: {\n          id: productid\n        }\n      }).then(response => {\n        product = response.data[0];\n        const new_product = {\n          id: product.id,\n          name: product.name,\n          price: product.price,\n          description: product.description,\n          quantity: product.quantity - quantity,\n          imageUrl: product.imageUrl\n        };\n        axios.put('/products', new_product).then(response => {\n          console.log(response.data);\n          const buyinfo = {\n            name: product.name,\n            total_price: product.price * quantity,\n            quantity: quantity,\n            mail: address.mail\n          };\n          console.log(buyinfo);\n          axios.post('/mail', buyinfo).then(response => {\n            console.log(response.data);\n            dialogVisible.value = false;\n            const loginfo = {\n              username: scope.row.user.username,\n              productid: scope.row.product.id,\n              productname: scope.row.product.name,\n              price: product.price,\n              quantity: quantity,\n              time: new Date(),\n              total: buyinfo.total_price\n            };\n            console.log(loginfo);\n            axios.post('/log', loginfo).then(response => {\n              console.log(response.data);\n              axios.delete();\n            });\n          });\n        });\n      });\n    };\n    const Delete = item => {\n      var id = item.row.cartid;\n      console.log(item.row.cartid);\n      axios.delete(`/cart/${id}`).then(response => {\n        console.log(response);\n        // 删除成功后刷新数据\n        fetchData();\n      }).catch(error => {\n        console.error(\"删除失败:\", error);\n      });\n    };\n    const dialogVisible = ref(false);\n    const items = ref([]);\n    const address = reactive({\n      mail: ''\n    });\n    const fetchData = () => {\n      axios.get('/cart', {\n        params: {\n          username: store.state.user.username\n        }\n      }).then(response => {\n        items.value = response.data;\n      }).catch(error => {\n        console.error(\"导入购物车失败:\", error);\n      });\n    };\n    onMounted(fetchData);\n    const __returned__ = {\n      Buy,\n      Pay,\n      Delete,\n      dialogVisible,\n      items,\n      address,\n      fetchData,\n      ref,\n      onMounted,\n      reactive,\n      get axios() {\n        return axios;\n      },\n      get store() {\n        return store;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","reactive","axios","store","Buy","scope","console","log","dialogVisible","value","Pay","address","row","productid","product","id","quantity","get","params","then","response","data","new_product","name","price","description","imageUrl","put","buyinfo","total_price","mail","post","loginfo","username","user","productname","time","Date","total","delete","Delete","item","cartid","fetchData","catch","error","items","state"],"sources":["C:/Users/DELL/Desktop/网络应用开发课程设计/vue-demo/src/components/market/Cart.vue"],"sourcesContent":["<script setup>\r\nimport {ref, onMounted, reactive} from \"vue\"\r\nimport axios from \"axios\";\r\nimport store from \"@/store\";\r\n\r\nconst Buy = (scope) => {\r\n  console.log(scope);\r\n  dialogVisible.value = true;\r\n}\r\n\r\n\r\nconst Pay = (scope, address) => {\r\n  console.log(scope.row);\r\n  var productid = scope.row.product.id;\r\n  var quantity = scope.row.quantity;\r\n  var product;\r\n  axios.get('/products', {params: {id: productid}})\r\n      .then(response => {\r\n        product = (response.data)[0];\r\n        const new_product = {\r\n          id: product.id,\r\n          name: product.name,\r\n          price: product.price,\r\n          description: product.description,\r\n          quantity: product.quantity - quantity,\r\n          imageUrl: product.imageUrl,\r\n        }\r\n        axios.put('/products', new_product)\r\n            .then(\r\n                response => {\r\n                  console.log(response.data);\r\n                  const buyinfo = {\r\n                    name: product.name,\r\n                    total_price: product.price * quantity,\r\n                    quantity: quantity,\r\n                    mail: address.mail\r\n                  }\r\n                  console.log(buyinfo);\r\n                  axios.post('/mail', buyinfo).then(response => {\r\n                    console.log(response.data)\r\n                    dialogVisible.value = false;\r\n                    const loginfo={\r\n                      username:scope.row.user.username,\r\n                      productid:scope.row.product.id,\r\n                      productname:scope.row.product.name,\r\n                      price:product.price,\r\n                      quantity:quantity,\r\n                      time:new Date(),\r\n                      total:buyinfo.total_price,\r\n                    }\r\n                    console.log(loginfo)\r\n                    axios.post('/log', loginfo).then(\r\n                        response => {\r\n                          console.log(response.data)\r\n\r\n\r\n\r\n                          axios.delete()\r\n                        })\r\n                  })\r\n                }\r\n            )\r\n      })\r\n\r\n\r\n}\r\n\r\nconst Delete = (item) => {\r\n  var id = item.row.cartid\r\n  console.log(item.row.cartid)\r\n  axios.delete(`/cart/${id}`)\r\n      .then(response => {\r\n        console.log(response)\r\n        // 删除成功后刷新数据\r\n        fetchData();\r\n      })\r\n      .catch(error => {\r\n        console.error(\"删除失败:\", error);\r\n      });\r\n};\r\n\r\nconst dialogVisible = ref(false)\r\n\r\nconst items = ref([])\r\n\r\nconst address = reactive({\r\n  mail: ''\r\n})\r\n\r\nconst fetchData = () => {\r\n  axios.get('/cart', {params: {username: store.state.user.username}})\r\n      .then(response => {\r\n        items.value = response.data;\r\n      })\r\n      .catch(error => {\r\n        console.error(\"导入购物车失败:\", error);\r\n      })\r\n};\r\n\r\nonMounted(fetchData)\r\n</script>\r\n\r\n<template>\r\n  <el-table\r\n      :data=\"items\"\r\n      style=\"width: 100%\"\r\n      :show-header=\"false\"\r\n  >\r\n    <el-table-column prop=\"productname\" label=\"商品名称\" width=\"150\"/>\r\n    <el-table-column prop=\"quantity\" label=\"商品数量\" width=\"120\"/>\r\n    <el-table-column prop=\"price\" label=\"商品价格\" width=\"120\"/>\r\n    <el-table-column fixed=\"right\" label=\"Operations\" width=\"120\">\r\n      <template #default=\"scope\">\r\n        <el-button link type=\"primary\" size=\"small\" @click=\"()=>{Buy(scope)}\">购买</el-button>\r\n        <el-button link type=\"primary\" size=\"small\" @click=\"()=>{Delete(scope)}\">删除</el-button>\r\n        <el-dialog\r\n            title=\"付款\"\r\n            :model-value=\"dialogVisible\"\r\n            @close=\"dialogVisible = false\">\r\n          <el-form :model=\"address\" class=\"form-container\">\r\n            <el-form-item label=\"邮箱地址\">\r\n              <el-input v-model=\"address.mail\"/>\r\n            </el-form-item>\r\n          </el-form>\r\n          <el-button type=\"primary\" @click=\"()=>{Pay(scope,address)}\">付款</el-button>\r\n        </el-dialog>\r\n      </template>\r\n    </el-table-column>\r\n  </el-table>\r\n\r\n</template>\r\n\r\n\r\n<style scoped>\r\n\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}